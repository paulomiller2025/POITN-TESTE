<!DOCTYPE html>
<html lang="pt">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>POINT — Multipliers</title>

<!-- Lightweight Charts (TradingView) -->
<script src="https://unpkg.com/lightweight-charts/dist/lightweight-charts.standalone.production.js"></script>

<style>
:root{
  --bg:#0b1220;--card:#141c2e;--muted:#9fb0d0;--ok:#22c55e;--warn:#eab308;--err:#ef4444;
  --primary:#2a62ff;--border:#263453;--panel:#0f1830;--text:#e6edf7;
}
*{box-sizing:border-box} body{margin:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial}
header{display:flex;align-items:center;justify-content:space-between;gap:10px;padding:12px 16px;border-bottom:1px solid var(--border);background:#0d1628;position:sticky;top:0;z-index:5}
.brand{display:flex;align-items:center;gap:8px} .brand h3{margin:0}
.badge{display:flex;align-items:center;gap:6px;font-size:12px;color:#cfe8ff}
.badge i{width:8px;height:8px;background:#22c55e;border-radius:50%}
.actions{display:flex;gap:8px}
button,select,input{border-radius:10px;border:1px solid var(--border);background:var(--panel);color:var(--text);padding:10px}
button{cursor:pointer} .primary{background:var(--primary);border-color:var(--primary)}
.danger{background:#9b2226;border-color:#9b2226}
main{max-width:1200px;margin:14px auto 80px;padding:0 12px}
.grid{display:grid;gap:14px} @media(min-width:980px){.grid{grid-template-columns:1.1fr .9fr}}
.card{background:var(--card);border:1px solid var(--border);border-radius:14px;padding:14px}
.kpi{display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:10px}
.pill{padding:10px 12px;border-radius:12px;background:var(--panel);border:1px solid var(--border)}
label{font-size:12px;color:var(--muted);display:block;margin-bottom:6px}
.row{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:10px}
@media(max-width:720px){.row{grid-template-columns:1fr} .kpi{grid-template-columns:1fr}}
.status{display:flex;align-items:center;gap:8px;margin-top:8px}
.st-green{background:#0a2c18;color:#7dffb2;border:1px solid #135f36;padding:4px 8px;border-radius:999px}
.st-red{background:#2c0a0a;color:#ff9a9a;border:1px solid #5f1313;padding:4px 8px;border-radius:999px}
.st-amber{background:#2c260a;color:#ffe08a;border:1px solid #5f4f13;padding:4px 8px;border-radius:999px}
.chartWrap{height:360px;background:#0b1524;border-radius:12px;border:1px solid #223052;position:relative}
#tv{position:absolute;inset:10px}
.controls{display:flex;flex-wrap:wrap;gap:8px;margin-top:8px}
.tbl{max-height:220px;overflow:auto;background:#08101b;border:1px solid #223052;border-radius:10px}
.rowh,.rowi{display:grid;grid-template-columns:100px 100px 120px 100px 100px;gap:8px;padding:6px 8px;align-items:center}
.rowh{font-weight:700;border-bottom:1px solid rgba(255,255,255,.06)}
.mini{font-size:12px;color:var(--muted)}
fieldset{border:1px dashed #2a3a5e;border-radius:10px;padding:10px}
.par{display:grid;grid-template-columns:1fr 1fr;gap:8px}
.progbar{height:10px;background:#08101b;border:1px solid #1f2b45;border-radius:999px;overflow:hidden}
.progbar i{display:block;height:100%;width:0%;transition:width .35s ease;background:linear-gradient(90deg,#22c55e,#16a34a)}
.label{display:flex;justify-content:space-between}
</style>
</head>
<body>

<header>
  <div class="brand"><h3>POINT — Multipliers</h3></div>
  <div class="badge"><i></i><span id="online">—</span> online</div>
  <div class="actions">
    <button id="btn_connect" class="primary">Autorizar & Conectar</button>
    <button id="btn_disconnect" class="danger">Desconectar</button>
  </div>
</header>

<main class="grid">

  <!-- ESQUERDA -->
  <section class="card">
    <h4>Conexão & Mercado</h4>
    <div class="row">
      <div>
        <label>Conta</label>
        <select id="account_select" disabled></select>
      </div>
      <div>
        <label>Moeda</label>
        <select id="currency"><option>USD</option><option>EUR</option><option>GBP</option></select>
      </div>
    </div>

    <div class="row" style="margin-top:8px">
      <div>
        <label>Símbolo (*multipliers*)</label>
        <select id="symbol"></select>
      </div>
      <div>
        <label>Timeframe da vela</label>
        <select id="tf">
          <option value="1">1s</option>
          <option value="5" selected>5s</option>
          <option value="10">10s</option>
          <option value="15">15s</option>
          <option value="30">30s</option>
          <option value="60">1m</option>
          <option value="120">2m</option>
          <option value="300">5m</option>
        </select>
      </div>
    </div>

    <div class="kpi" style="margin-top:10px">
      <div class="pill"><b>Tipo</b><div id="acct_type" class="mini">—</div></div>
      <div class="pill"><b>Saldo</b><div id="balance">—</div></div>
      <div class="pill"><b>P/L Sessão</b><div id="pl_session">$0.00</div></div>
    </div>

    <div class="kpi" style="margin-top:10px">
      <div class="pill"><b>Posição</b><div id="pos_info">—</div></div>
      <div class="pill"><b>Status</b>
        <div class="status">
          <span id="st_conn" class="st-red">Offline</span>
          <span id="st_ticks" class="st-amber">Sem Ticks</span>
          <span class="mini">Último preço: <b id="last_price">—</b></span>
        </div>
      </div>
      <div class="pill">
        <b>Gráfico</b>
        <div class="chartWrap"><div id="tv"></div></div>
        <div class="controls">
          <button id="btn_reset" title="Limpar histórico">Reset</button>
        </div>
      </div>
    </div>

    <fieldset style="margin-top:12px">
      <legend>Ordem Multiplier</legend>
      <div class="controls">
        <div>
          <label>Stake</label>
          <input id="stake" type="number" step="0.01" value="1.00" style="width:110px"/>
        </div>
        <div>
          <label>Perfil</label>
          <select id="profile" style="width:150px">
            <option value="cons" selected>Conservador (20–30x)</option>
            <option value="mod">Moderado (50x)</option>
            <option value="agg">Agressivo (100–200x)</option>
          </select>
        </div>
        <div>
          <label>Multiplicador (opcional)</label>
          <input id="multiplier" type="number" step="1" placeholder="auto" style="width:120px"/>
        </div>
        <div>
          <label>TP (opcional)</label>
          <input id="tp" type="number" step="0.01" placeholder="ex.: 5.00" style="width:120px"/>
        </div>
        <div>
          <label>SL (opcional)</label>
          <input id="sl" type="number" step="0.01" placeholder="ex.: 3.00" style="width:120px"/>
        </div>
        <button id="btn_down" class="danger">DOWN (MULTDOWN)</button>
        <button id="btn_up" class="primary">UP (MULTUP)</button>
        <button id="btn_close">Fechar Posição</button>
      </div>
      <div class="mini">TP/SL são valores em moeda (por exemplo, USD). Multiplicador será escolhido pelo perfil se você não preencher.</div>
    </fieldset>
  </section>

  <!-- DIREITA -->
  <section class="card">
    <h4>Probabilidades & Histórico</h4>

    <fieldset>
      <legend>Momentum (tendência curta)</legend>
      <div class="par">
        <div>
          <div class="label"><span>Prob. UP</span><b id="p_up">—</b></div>
          <div class="progbar"><i id="bar_up" style="width:0%"></i></div>
        </div>
        <div>
          <div class="label"><span>Prob. DOWN</span><b id="p_dn">—</b></div>
          <div class="progbar"><i id="bar_dn" style="width:0%"></i></div>
        </div>
      </div>
      <div class="mini" id="mom_note">Leitura: —</div>
    </fieldset>

    <fieldset style="margin-top:10px">
      <legend>Sugestões de Multiplicador</legend>
      <div class="mini" id="mult_note">Com base no perfil e saldo.</div>
      <div class="tbl" style="margin-top:8px">
        <div class="rowh"><span>Hora</span><span>Tipo</span><span>Símbolo</span><span>Stake</span><span>P/L</span></div>
        <div id="hist"></div>
      </div>
    </fieldset>
  </section>

</main>

<script>
/* ===================== Utils ===================== */
const $=id=>document.getElementById(id);
const APP_ID = '98640';
const OAUTH_SCOPE = 'read trade';
const REDIRECT_URI = location.origin + location.pathname;

function fmtMoney(n, d=2){ return (Number.isFinite(+n)? (+n).toFixed(d): String(n)); }
function nowStr(){ return new Date().toLocaleTimeString(); }
function percent(x){ return (x*100).toFixed(1)+'%'; }

/* ===================== Estado ===================== */
let ws=null, authorized=false, account=null, account_info={};
let candlesSubId=null, ticksSubId=null;
let pocSubscribing=false;
let open_position=null; // {contract_id, buy_price, currency, side, symbol}
let session_pl=0;
let lastPrice=null;

let reconnectTmr=null, reconnectTry=0;
let lastCandleAt=0, lastPOCAt=0;

/* Anti compra duplicada */
let order_lock=false, lock_timer=null;
function armLock(){
  order_lock=true;
  clearTimeout(lock_timer);
  lock_timer=setTimeout(()=>{ order_lock=false; }, 8000);
}
function releaseLock(){ order_lock=false; clearTimeout(lock_timer); lock_timer=null; }

/* ===================== OAuth ===================== */
function beginOAuth(){
  const url = `https://oauth.deriv.com/oauth2/authorize?app_id=${APP_ID}&redirect_uri=${encodeURIComponent(REDIRECT_URI)}&scope=${encodeURIComponent(OAUTH_SCOPE)}`;
  location.href = url;
}
function parseOAuthTokens(){
  const h=new URLSearchParams(location.hash.slice(1));
  const s=new URLSearchParams(location.search);
  s.forEach((v,k)=>{ if(!h.get(k)) h.set(k,v); });
  const out=[];
  const push=(tk,acct,cur)=>{ if(tk && acct) out.push({token:tk, loginid:acct, is_virtual:/VRTC/.test(acct), currency:cur||'USD'}); };
  if (h.get('token')||h.get('acct')) push(h.get('token'),h.get('acct'),h.get('cur'));
  for(let i=1;i<=20;i++) push(h.get('token'+i),h.get('acct'+i),h.get('cur'+i));
  if (out.length){
    localStorage.setItem('deriv_oauth_map', JSON.stringify(out));
    history.replaceState({}, document.title, REDIRECT_URI);
  } else {
    try{ const cache=JSON.parse(localStorage.getItem('deriv_oauth_map')||'[]'); if(Array.isArray(cache)) return cache; }catch{}
  }
  return out;
}
function populateAccounts(){
  const list=parseOAuthTokens(); const sel=$('account_select'); sel.innerHTML='';
  if(!list.length){ sel.disabled=true; return; }
  list.forEach((a,i)=>{ const o=document.createElement('option'); o.value=String(i); o.textContent=`${a.loginid} • ${a.is_virtual?'DEMO':'REAL'} ${a.currency}`; sel.appendChild(o); });
  sel.disabled=false;
}
function getSelectedAccount(){ const list=parseOAuthTokens(); const idx=parseInt(($('account_select').value||'0'),10); return list[idx]||null; }

/* ===================== WebSocket ===================== */
function wsSend(o){ if(ws && ws.readyState===1) ws.send(JSON.stringify(o)); }
function scheduleReconnect(){
  if (reconnectTmr) return;
  const delay = Math.min(30000, (1<<Math.min(reconnectTry,5))*1000); // 1,2,4,8,16,30s
  reconnectTmr=setTimeout(()=>{ reconnectTmr=null; reconnectTry++; if(parseOAuthTokens().length) connectWS(); }, delay);
}

function connectWS(){
  const acc=getSelectedAccount(); if(!acc){ beginOAuth(); return; }
  account=acc; $('currency').value=acc.currency||'USD';

  if (ws){ try{ ws.close(); }catch(e){} }
  ws = new WebSocket(`wss://ws.derivws.com/websockets/v3?app_id=${APP_ID}`);

  ws.onopen = ()=> wsSend({authorize:acc.token});

  ws.onclose=()=>{ authorized=false; $('st_conn').className='st-red'; $('st_conn').textContent='Offline'; scheduleReconnect(); };
  ws.onerror=()=>{ try{ ws.close(); }catch(e){} };

  ws.onmessage=(m)=>{
    const data=JSON.parse(m.data);

    if (data.error){
      console.warn('Deriv error:', data.error);
      releaseLock(); return;
    }

    switch(data.msg_type){

      case 'authorize':
        authorized=true; reconnectTry=0;
        account_info=data.authorize;
        $('acct_type').textContent=account_info.is_virtual?'Conta DEMO':'Conta REAL';
        $('st_conn').className='st-green'; $('st_conn').textContent='Conectado';
        wsSend({balance:1, subscribe:1});
        loadActiveSymbols(); // multipliers list
        startWatchdogs();
        break;

      case 'balance':
        $('balance').textContent = `${fmtMoney(data.balance.balance,2)} ${data.balance.currency}`;
        break;

      case 'active_symbols':
        fillSymbols(data.active_symbols||[]);
        // auto subscribe first symbol
        const sel=$('symbol').value; if (sel) subscribeCandles(sel, parseInt($('tf').value,10)||5);
        break;

      case 'candles': // history snapshot
        applyCandles(data.candles||[]);
        break;

      case 'ohlc':    // streaming candle
        onOhlc(data.ohlc);
        break;

      case 'tick': // (não usamos aqui)
        break;

      case 'proposal':
        // buy imediatamente depois de receber a proposta
        if (data.proposal && data.proposal.id && order_lock){
          wsSend({ buy: data.proposal.id, price: data.proposal.ask_price });
        }
        break;

      case 'buy':
        onBuyFilled(data.buy);
        break;

      case 'sell':
        onSellFilled(data.sell);
        break;

      case 'proposal_open_contract':
        lastPOCAt = Date.now();
        onPOC(data.proposal_open_contract);
        break;
    }
  };
}

function loadActiveSymbols(){
  // Apenas símbolos com produto "multipliers" (resolve dropdown vazio)
  wsSend({ active_symbols: 'full', product_type: 'multipliers' });
}

function fillSymbols(list){
  const sel=$('symbol'); sel.innerHTML='';
  // Ordena por nome bonito
  list.sort((a,b)=>(a.display_name||'').localeCompare(b.display_name||''));
  list.forEach(s=>{
    const o=document.createElement('option');
    o.value=s.symbol; o.textContent=s.display_name || s.symbol;
    sel.appendChild(o);
  });
  $('st_ticks').className='st-amber'; $('st_ticks').textContent='Sem Ticks';
}

function forgetAll(){
  if (ticksSubId) wsSend({ forget: ticksSubId });
  if (candlesSubId) wsSend({ forget: candlesSubId });
  ticksSubId=null; candlesSubId=null;
}

function subscribeCandles(symbol, gran){
  if (!authorized) return;
  forgetAll();
  lastCandleAt=Date.now();

  // histórico + subscribe
  wsSend({ ticks_history: symbol, style: 'candles', count: 200, granularity: gran, subscribe: 1 });
  // Deriv envia 'candles' (histórico) e, depois, 'ohlc' como stream
  $('st_ticks').className='st-amber'; $('st_ticks').textContent='Carregando...';
}

/* ===================== Chart (Lightweight) ===================== */
let chart, series;
function initChart(){
  const el=$('tv');
  if (chart) { chart.remove(); chart=null; }
  chart = LightweightCharts.createChart(el, {
    layout:{ background:{ type: 'Solid', color: '#0b1524' }, textColor:'#cfe8ff' },
    grid:{ vertLines:{ color:'#0f2038' }, horzLines:{ color:'#0f2038' } },
    timeScale:{ rightOffset:6, barSpacing:6, fixLeftEdge:true, fixRightEdge:false, borderColor:'#1f2b45' },
    crosshair:{ mode:1 },
    rightPriceScale:{ borderColor:'#1f2b45' }
  });
  series = chart.addCandlestickSeries({
    upColor:'#ffffff', downColor:'#ffffff',
    wickUpColor:'#ffffff', wickDownColor:'#ffffff',
    borderUpColor:'#ffffff', borderDownColor:'#ffffff'
  });
  // pontos azuis nos fechamentos
  const point = chart.addScatterSeries({ color:'#4da3ff', size:3 });
  series._bluePoints = point;
}

function applyCandles(cs){
  if (!series) initChart();
  const data = cs.map(c=>({ time: c.epoch, open:+c.open, high:+c.high, low:+c.low, close:+c.close }));
  series.setData(data);
  // pontos
  const dots = data.map(d=>({ time:d.time, position:'aboveBar', price:d.close }));
  series._bluePoints.setData(dots);
  lastCandleAt = Date.now();
  $('st_ticks').className='st-green'; $('st_ticks').textContent='OK';
  if (data.length) { lastPrice = data[data.length-1].close; $('last_price').textContent = fmtMoney(lastPrice,2); }
  // alimente a engine de probabilidade
  Prob.reset();
  data.forEach(d=>Prob.onCandle(d));
}

function onOhlc(o){
  if (!series) return;
  const cd = { time:o.epoch, open:+o.open, high:+o.high, low:+o.low, close:+o.close };
  series.update(cd);
  series._bluePoints.update({ time:cd.time, position:'aboveBar', price:cd.close });
  lastCandleAt = Date.now();
  lastPrice = cd.close; $('last_price').textContent = fmtMoney(lastPrice,2);
  Prob.onCandle(cd);
}

/* ===================== Probabilidade (EMA 9/21 + direção) ===================== */
const Prob=(function(){
  const state={ closes:[], ema9:null, ema21:null, up:0, dn:0, N:200, lastUp:0.5, lastDn:0.5 };
  const els={ pUp:$('p_up'), pDn:$('p_dn'), bUp:$('bar_up'), bDn:$('bar_dn'), note:$('mom_note') };
  function ema(prev,x,len){ return prev==null?x:(prev + (2/(len+1))*(x-prev)); }
  function clamp(x,a,b){ return Math.max(a,Math.min(b,x)); }
  function onCandle(c){
    const cl=c.close;
    const arr=state.closes; arr.push(cl); if(arr.length>state.N) arr.shift();
    // contagem up/down por close->close
    if (arr.length>=2){
      const prev = arr[arr.length-2];
      if (cl>prev) state.up++; else if (cl<prev) state.dn++;
      if (state.up+state.dn>state.N-1){ // mantém janela
        const p2 = arr[arr.length-2], p3 = arr[arr.length-3];
        if (p2>p3) state.up--; else if (p2<p3) state.dn--;
      }
    }
    state.ema9  = ema(state.ema9,  cl, 9);
    state.ema21 = ema(state.ema21, cl, 21);
    // prob: base Beta(up, dn) + viés da EMA
    let pUp = (0.5 + state.up) / (1 + state.up + state.dn);
    const bias = (state.ema9!=null && state.ema21!=null) ? (state.ema9>state.ema21? +0.06 : -0.06) : 0;
    pUp = clamp(pUp + bias, 0, 1);
    const pDn = 1 - pUp;
    state.lastUp=pUp; state.lastDn=pDn;
    els.pUp.textContent = percent(pUp); els.pDn.textContent = percent(pDn);
    els.bUp.style.width = (pUp*100)+'%'; els.bDn.style.width = (pDn*100)+'%';
    els.note.textContent = (bias>0? 'EMAs favorecem alta' : (bias<0? 'EMAs favorecem queda' : 'Neutro'));
  }
  function reset(){ state.closes.length=0; state.ema9=null; state.ema21=null; state.up=0; state.dn=0; state.lastUp=.5; state.lastDn=.5;
    els.pUp.textContent='—'; els.pDn.textContent='—'; els.bUp.style.width='0%'; els.bDn.style.width='0%'; els.note.textContent='Leitura: —'; }
  function snap(){ return {pUp:state.lastUp, pDn:state.lastDn}; }
  return { onCandle, reset, snap };
})();

/* ===================== Trading (MULTUP/MULTDOWN) ===================== */
function pickMultiplier(){
  const prof=$('profile').value;
  const explicit=parseInt($('multiplier').value||'',10);
  if (Number.isFinite(explicit) && explicit>0) return explicit;
  if (prof==='cons') return 30;
  if (prof==='mod')  return 50;
  return 100; // agg
}

function propose(side){ // 'MULTUP' | 'MULTDOWN'
  if (!authorized || order_lock) return;
  const symbol=$('symbol').value; if(!symbol) return;
  const currency=$('currency').value;
  const amount=parseFloat($('stake').value)||1;
  const mult=pickMultiplier();
  const tp = $('tp').value.trim(); const sl = $('sl').value.trim();
  const payload={ proposal:1, symbol, contract_type:side, basis:'stake', amount, currency, multiplier:mult };
  if (tp) payload.take_profit = parseFloat(tp);
  if (sl) payload.stop_loss = parseFloat(sl);
  armLock();
  wsSend(payload);
}

function onBuyFilled(buy){
  releaseLock();
  if (!buy || !buy.contract_id) return;
  open_position={ contract_id: buy.contract_id, buy_price:+buy.buy_price, currency:buy.currency, side:buy.longcode?.includes('Up')?'MULTUP':'MULTDOWN', symbol:$('symbol').value };
  $('pos_info').textContent = `${open_position.side} @ ${open_position.symbol}`;
  // assinar POC
  if (!pocSubscribing){
    pocSubscribing=true;
    wsSend({ proposal_open_contract:1, contract_id:open_position.contract_id, subscribe:1 });
    setTimeout(()=>{ pocSubscribing=false; }, 200);
  }
}

function onPOC(poc){
  if (!poc) return;
  lastPOCAt=Date.now();
  if (!poc.is_sold){
    if (poc.current_spot) $('last_price').textContent = fmtMoney(poc.current_spot,2);
    if (poc.profit !== undefined){
      const pl = +poc.profit;
      $('pl_session').textContent = '$'+fmtMoney(session_pl + pl,2);
    }
  } else {
    // posição encerrada
    const pl = +poc.profit;
    session_pl += pl;
    $('pl_session').textContent = '$'+fmtMoney(session_pl,2);
    addHistRow(open_position?.side||'-', open_position?.symbol||'-', open_position?.buy_price||0, pl);
    open_position=null; $('pos_info').textContent='—';
  }
}

function onSellFilled(sell){
  // Deriv envia POC final logo após; nada a fazer aqui além de soltar o lock.
  releaseLock();
}

function closePosition(){
  if (!open_position) return;
  wsSend({ sell: open_position.contract_id, price: 0 }); // market
}

/* ===================== Histórico ===================== */
function addHistRow(type,sym,stake,pl){
  const row=document.createElement('div'); row.className='rowi';
  row.innerHTML=`<span>${nowStr()}</span><span>${type}</span><span>${sym}</span><span>$${fmtMoney(stake,2)}</span>
                 <span style="color:${pl>=0?'#22c55e':'#ef4444'}">$${fmtMoney(pl,2)}</span>`;
  $('hist').prepend(row);
}

/* ===================== Watchdogs ===================== */
let wdStarted=false;
function startWatchdogs(){
  if (wdStarted) return; wdStarted=true;
  setInterval(()=>{
    const now=Date.now();
    if (!ws || ws.readyState!==1){ scheduleReconnect(); return; }
    if (authorized && (now - lastCandleAt) > 10000){
      // re-assina o ativo atual
      try{ subscribeCandles($('symbol').value, parseInt($('tf').value,10)||5); }catch(e){}
      lastCandleAt=now;
    }
    if (open_position && (now - lastPOCAt) > 15000){
      try{ wsSend({ proposal_open_contract:1, contract_id:open_position.contract_id, subscribe:1 }); }catch(e){}
      lastPOCAt=now;
    }
  }, 2000);
}

/* ===================== UI bindings ===================== */
$('btn_connect').onclick=connectWS;
$('btn_disconnect').onclick=()=>{
  try{ if(ws) ws.close(); }catch(e){}
  authorized=false; $('st_conn').className='st-red'; $('st_conn').textContent='Offline';
  open_position=null; $('pos_info').textContent='—';
};
$('account_select').onchange=()=>connectWS();
$('symbol').onchange=()=>{ if(authorized) subscribeCandles($('symbol').value, parseInt($('tf').value,10)||5); Prob.reset(); };
$('tf').onchange=()=>{ if(authorized) subscribeCandles($('symbol').value, parseInt($('tf').value,10)||5); };
$('btn_reset').onclick=()=>{ Prob.reset(); initChart(); if(authorized) subscribeCandles($('symbol').value, parseInt($('tf').value,10)||5); };

$('btn_up').onclick = ()=>propose('MULTUP');
$('btn_down').onclick= ()=>propose('MULTDOWN');
$('btn_close').onclick= closePosition;

/* online counter fake */
(function(){ const el=$('online'); function bump(){ el.textContent= String(200+Math.floor(Math.random()*300)); } bump(); setInterval(bump,12000); })();

/* ===================== Boot ===================== */
window.addEventListener('DOMContentLoaded', ()=>{
  populateAccounts();
  initChart();
  if (parseOAuthTokens().length) connectWS();
});
</script>

</body>
</html>
